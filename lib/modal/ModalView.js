"use strict";"use client";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _react=_interopRequireDefault(require("react"));var _reactNative=require("react-native");var _portal=_interopRequireDefault(require("../portal"));function _callSuper(t,o,e){return o=(0,_getPrototypeOf2.default)(o),(0,_possibleConstructorReturn2.default)(t,_isNativeReflectConstruct()?Reflect.construct(o,e||[],(0,_getPrototypeOf2.default)(t).constructor):o.apply(t,e));}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));}catch(t){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t;})();}var styles=_reactNative.StyleSheet.create({wrap:{flex:1,backgroundColor:'rgba(0,0,0,0)'},mask:{backgroundColor:'black',opacity:0.5},content:{backgroundColor:'white'},absolute:{position:'absolute',top:0,bottom:0,left:0,right:0}});var screen=_reactNative.Dimensions.get('window');var RCModal=function(_React$Component){function RCModal(props){var _this;(0,_classCallCheck2.default)(this,RCModal);_this=_callSuper(this,RCModal,[props]);_this.backHandlerSubscription=null;_this.onBackAndroid=function(){var onRequestClose=_this.props.onRequestClose;if(typeof onRequestClose==='function'){return onRequestClose();}return false;};_this.animateMask=function(visible){_this.stopMaskAnim();_this.state.opacity.setValue(_this.getOpacity(!visible));_this.animMask=_reactNative.Animated.timing(_this.state.opacity,{toValue:_this.getOpacity(visible),duration:_this.props.animationDuration,useNativeDriver:true});_this.animMask.start(function(){_this.animMask=null;});};_this.stopMaskAnim=function(){if(_this.animMask){_this.animMask.stop();_this.animMask=null;}};_this.stopDialogAnim=function(){if(_this.animDialog){_this.animDialog.stop();_this.animDialog=null;}};_this.animateDialog=function(visible){var _a;_this.stopDialogAnim();_this.animateMask(visible);var _this$props=_this.props,animationType=_this$props.animationType,animationDuration=_this$props.animationDuration;animationDuration=animationDuration;if(animationType!=='none'){if(animationType==='slide-up'||animationType==='slide-down'){_this.state.position.setValue(_this.getPosition(!visible));_this.animDialog=_reactNative.Animated.timing(_this.state.position,{toValue:_this.getPosition(visible),duration:animationDuration,easing:visible?_reactNative.Easing.elastic(0.8):undefined,useNativeDriver:true});}else if(animationType==='fade'){_this.animDialog=_reactNative.Animated.parallel([_reactNative.Animated.timing(_this.state.opacity,{toValue:_this.getOpacity(visible),duration:animationDuration,easing:visible?_reactNative.Easing.elastic(0.8):undefined,useNativeDriver:true}),_reactNative.Animated.spring(_this.state.scale,{toValue:_this.getScale(visible),useNativeDriver:true})]);}_this.animDialog.start(function(){var _a;_this.animDialog=null;if(!visible){_this.setState({modalVisible:false});(_a=_this.backHandlerSubscription)===null||_a===void 0?void 0:_a.remove();}if(_this.props.onAnimationEnd){_this.props.onAnimationEnd(visible);}});}else{if(!visible){_this.setState({modalVisible:false});(_a=_this.backHandlerSubscription)===null||_a===void 0?void 0:_a.remove();}}};_this.close=function(){_this.animateDialog(false);};_this.onMaskClose=function(){var _a;if(_this.props.maskClosable&&_this.props.onClose){_this.props.onClose();(_a=_this.backHandlerSubscription)===null||_a===void 0?void 0:_a.remove();}};_this.getPosition=function(visible){if(visible){return 0;}return _this.props.animationType==='slide-down'?-screen.height:screen.height;};_this.getScale=function(visible){return visible?1:1.05;};_this.getOpacity=function(visible){return visible?1:0;};var visible=props.visible;_this.state={position:new _reactNative.Animated.Value(_this.getPosition(visible)),scale:new _reactNative.Animated.Value(_this.getScale(visible)),opacity:new _reactNative.Animated.Value(_this.getOpacity(visible)),modalVisible:visible};return _this;}(0,_inherits2.default)(RCModal,_React$Component);return(0,_createClass2.default)(RCModal,[{key:"UNSAFE_componentWillReceiveProps",value:function UNSAFE_componentWillReceiveProps(nextProps){if(this.shouldComponentUpdate(nextProps,null)){this.setState({modalVisible:true});}}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(nextProps,nextState){if(this.props.visible||this.props.visible!==nextProps.visible){return true;}if(nextState){if(nextState.modalVisible!==this.state.modalVisible){return true;}}return false;}},{key:"componentDidMount",value:function componentDidMount(){if(this.props.animateAppear&&this.props.animationType!=='none'){this.backHandlerSubscription=_reactNative.BackHandler.addEventListener('hardwareBackPress',this.onBackAndroid);this.componentDidUpdate({});}}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){var props=this.props;if(prevProps.visible!==props.visible){this.animateDialog(props.visible);}}},{key:"componentWillUnmount",value:function componentWillUnmount(){var _a;(_a=this.backHandlerSubscription)===null||_a===void 0?void 0:_a.remove();this.stopDialogAnim();}},{key:"render",value:function render(){var props=this.props;if(!this.state.modalVisible){return null;}var animationStyleMap={none:{},'slide-up':{transform:[{translateY:this.state.position}]},'slide-down':{transform:[{translateY:this.state.position}]},fade:{transform:[{scale:this.state.scale}],opacity:this.state.opacity}};var Modal=_portal.default;switch(props.modalType){case'modal':Modal=function Modal(p){return _react.default.createElement(_reactNative.Modal,(0,_extends2.default)({visible:true,transparent:true},p));};break;case'view':Modal=function Modal(p){return _react.default.createElement(_reactNative.View,(0,_extends2.default)({style:_reactNative.StyleSheet.absoluteFill},p));};}return _react.default.createElement(Modal,null,_react.default.createElement(_reactNative.View,{style:[styles.wrap,props.wrapStyle]},_react.default.createElement(_reactNative.TouchableWithoutFeedback,{onPress:this.onMaskClose},_react.default.createElement(_reactNative.Animated.View,{style:[styles.absolute,{opacity:this.state.opacity}]},_react.default.createElement(_reactNative.View,{style:[styles.absolute,props.maskStyle]}))),_react.default.createElement(_reactNative.Animated.View,{style:[styles.content,props.style,animationStyleMap[props.animationType]]},this.props.children)));}}]);}(_react.default.Component);RCModal.defaultProps={wrapStyle:styles.wrap,maskStyle:styles.mask,animationType:'slide-up',animateAppear:false,animationDuration:300,visible:false,maskClosable:true,onClose:function onClose(){},onAnimationEnd:function onAnimationEnd(_visible){},modalType:'portal'};var _default=exports.default=RCModal;